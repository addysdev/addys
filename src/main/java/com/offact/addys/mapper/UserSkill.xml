<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="UserSkill">

	<resultMap id="userSkillVo" type="com.offact.addys.vo.common.UserSkillVO">
        <result column="USER_DEPT_CODE" property="userDeptCode"/>
        <result column="USER_ID"        property="userId"/>      
        <result column="SKILL_CODE"     property="skillCode"/>   
        <result column="SKILL_NM"     property="skillNm"/>   
        <result column="SKILL_YN"       property="skillYn"/>
        <result column="SKILL_GROUP_CODE"       property="skillGroupCode"/>
        <result column="SKILL_GROUP_CODE_NM"   property="skillGroupCodeNm"/>  
        <result column="SKILL_GROUP_CODE_CNT"   property="skillGroupCodeCnt"/>  
	</resultMap>
  
  
  
 
	
    <select id="getSkillList"  resultMap="userSkillVo" parameterType="com.offact.addys.vo.ad.ADUserListManageVO">
        <![CDATA[ 
		SELECT 
		       TB_SKILL.USER_DEPT_CODE , 
		       TB_SKILL.SKILL_CODE , 
		       TB_SKILL.SKILL_NM , 
		       TB_SKILL.VDN_CODE , 
		       TB_SKILL.DESCRIPTION , 
		       TB_SKILL.SKILL_GROUP_CODE , 
		       (SELECT 
		              IN_TB_SKILL.SKILL_NM 
		       FROM 
		              TB_SKILL IN_TB_SKILL 
		       WHERE 
		              IN_TB_SKILL.SKILL_CODE = TB_SKILL.SKILL_GROUP_CODE
		       ) as SKILL_GROUP_CODE_NM , 
		       TB_SKILL.CALL_SKILL_YN , 
		       TB_SKILL.FRST_REG_TS , 
		       TB_SKILL.FRST_REGR_ID , 
		       TB_SKILL.LAST_MOD_TS , 
		       TB_SKILL.LAST_CORT_ID 
		FROM 
		       TB_SKILL 
		WHERE  skill_code <> skill_group_code
		and   TB_SKILL.USER_DEPT_CODE = #{userDeptCode}
		ORDER BY 
		       TB_SKILL.skill_code
    ]]> 		       
    </select>
	

    <select id="getCurrUserSkillList"  resultMap="userSkillVo" parameterType="com.offact.addys.vo.common.UserSkillVO">
			SELECT 
			       USER_DEPT_CODE, 
			       USER_ID, 
			       SKILL_CODE
			FROM 
			       TB_USER_SKILL 
			WHERE   SKILL_YN = 'Y'  
			       AND USER_DEPT_CODE =  #{userDeptCode}
			       AND USER_ID = #{userId}
			ORDER BY SKILL_CODE
    </select>
    
    
    
    


    <select id="getConsultCateList"  resultMap="userSkillVo" >
		SELECT 
		       TB_SKILL.USER_DEPT_CODE , 
		       TB_SKILL.SKILL_CODE , 
		       TB_SKILL.SKILL_NM , 
		       TB_SKILL.VDN_CODE , 
		       TB_SKILL.DESCRIPTION , 
		       TB_SKILL.SKILL_GROUP_CODE , 
		       (SELECT 
		              count(*) 
		       FROM 
		              TB_SKILL IN_TB_SKILL 
		       WHERE 
		              IN_TB_SKILL.SKILL_GROUP_CODE = TB_SKILL.SKILL_CODE
		       ) as SKILL_GROUP_CODE_CNT , 
		       TB_SKILL.CALL_SKILL_YN , 
		       TB_SKILL.FRST_REG_TS , 
		       TB_SKILL.FRST_REGR_ID , 
		       TB_SKILL.LAST_MOD_TS , 
		       TB_SKILL.LAST_CORT_ID 
		FROM 
		       TB_SKILL 
		WHERE 
		       skill_code = skill_group_code 
		ORDER BY 
		       TB_SKILL.skill_code
    </select>
    


    <delete id="deleteUserSkill" parameterType="java.util.Map">
        delete from TB_USER_SKILL where USER_DEPT_CODE = #{userDeptCode} and USER_ID = #{userId} 
    </delete>
    <insert id="insertUserSkill" parameterType="com.offact.addys.vo.common.UserSkillVO">
        insert into TB_USER_SKILL( USER_DEPT_CODE
                                    ,USER_ID
                                    ,SKILL_CODE
                                    ,SKILL_YN
                                    ,FRST_REG_TS
                                    ,FRST_REGR_ID
                                    ,LAST_MOD_TS
                                    ,LAST_CORT_ID )
        values( #{userDeptCode}, #{userId},#{skillCode},'Y',now(),#{frstRegrId},now(),#{lastCortId})          
    </insert>

	
</mapper>
