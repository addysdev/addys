<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ADCodeManage">

  <resultMap id="codeVO" type="com.offact.addys.vo.ADCodeManageVO" >
    <result column="code_id" property="codeId"  />
    <result column="code_nm" property="codeNm"  />
    <result column="code" property="code"  />
    <result column="name" property="name"  />
    <result column="description" property="description"  />
    <result column="using_yn" property="usingYn"  />
    <result column="frst_reg_ts" property="frstRegTs"  />
    <result column="frst_regr_id" property="frstRegrId"  />
    <result column="last_mod_ts" property="lastModTs"  />
    <result column="last_cort_id" property="lastCortId"  />
  </resultMap>



  <resultMap id="categoryVO" type="com.offact.addys.vo.common.CategoryVO" >
	<result column="CATEGORY_S_CODE" property="categorySCode"  />
	<result column="CATEGORY_S_NM" property="categorySNm"  />
	<result column="CATEGORY_L_CODE" property="categoryLCode"  />
	<result column="CATEGORY_L_NM" property="categoryLNm"  />
	<result column="FRST_REG_TS" property="frstRegTs"  />
	<result column="FRST_REGR_ID" property="frstRegrId"  />
	<result column="LAST_MOD_TS" property="lastModTs"  />
	<result column="LAST_CORT_ID" property="lastCortId"  />
  </resultMap>



	<select id="getCategoryLList" resultMap="categoryVO" >
		select  CATEGORY_L_CODE
		    ,   CATEGORY_L_NM
		from TB_CATEGORY
		group by CATEGORY_L_CODE
		    ,   CATEGORY_L_NM
	</select>
  
  
  
    <select id="getCategorySList" resultMap="categoryVO" parameterType="com.offact.addys.vo.common.CategoryVO" >
		select  CATEGORY_S_CODE
		    ,   CATEGORY_S_NM
		from TB_CATEGORY
		where CATEGORY_L_CODE = #{categoryLCode};
    </select>
  
  
  
  
   <select id="getCodeContents" resultMap="codeVO" parameterType="com.offact.addys.vo.ADCodeManageVO" >
	SELECT  a.code_id,
	           b.code_nm, 
	           a.code,
	           a.name,
	           a.description,
	           a.using_yn
     FROM TB_CODE a INNER JOIN  TB_CODE_GROUP b
     on a.CODE_ID=b.CODE_ID
     WHERE a.code =  #{code}
     and a.code_id = #{codeId}
  </select>

	<select id="getCodeCnt" resultType="int">
    SELECT  COUNT(*) AS TOT_COUNT
    FROM   TB_CODE
	</select> 
	
	<select id="getCodeMax" resultType="java.lang.String">
    SELECT  IFNULL(MAX(NO),0)+1 AS MAX_COUNT
    FROM   TB_CODE
	</select> 	
	
	<select id="getCodeList"  resultMap="codeVO" parameterType="com.offact.addys.vo.ADCodeManageVO" >
	SELECT   A.*
	FROM
	 (
	 SELECT @ROWNUM := @ROWNUM + 1 AS ROWNUM, A.*
	 FROM
	(
	    SELECT
	           a.code_id as code_id,
	           b.code_nm, 
	           a.CODE,
	           a.name,
	           a.description,
	           a.using_yn
	    FROM TB_CODE a INNER JOIN  TB_CODE_GROUP b
               on a.CODE_ID=b.CODE_ID,
               (SELECT @ROWNUM := 0) R
	    ORDER BY a.CODE_ID ASC
	) A)A
	WHERE  A.ROWNUM BETWEEN (#{curPage}-1) * #{rowCount}+1 AND #{curPage} * #{rowCount}
	</select>	
		
	<select id="getCodeComboList"  resultMap="codeVO" parameterType="com.offact.addys.vo.ADCodeManageVO" >
	    SELECT
	           a.code_id,
	           b.code_nm, 
	           a.CODE,
	           a.name,
	           a.description,
	           a.using_yn
	    FROM TB_CODE a INNER JOIN  TB_CODE_GROUP b
               on a.CODE_ID=b.CODE_ID
        where  a.USING_YN = 'Y'              
		<if test="codeId != null and codeId != ''" >
		and a.CODE_ID = #{codeId}
		</if>
		<if test="searchcode != null and searchcode != ''" >
		and a.CODE = #{searchcode}
		</if>
		<if test="searchattribution_1 != null and searchattribution_1 != ''" >
		and a.ATTRIBUTION_1 = #{searchattribution_1}
		</if>
	    ORDER BY a.CODE_ID ASC
	</select>	



    <select id="getDeptCodeComboList"  resultMap="codeVO" parameterType="com.offact.addys.vo.ADCodeManageVO" >
        SELECT
               a.code_id,
               b.code_nm, 
               a.CODE,
               a.name,
               a.description,
               a.using_yn
        FROM TB_CODE a INNER JOIN  TB_CODE_GROUP b
               on a.CODE_ID=b.CODE_ID
        where  a.USING_YN = 'Y'              
        <if test="codeId != null and codeId != ''" >
        and a.CODE_ID = #{codeId}
        </if>
        <if test="sessionUserGroupcode != 'LV0'" >
        and a.CODE = #{sessionUserDeptcode}
        </if>
        ORDER BY a.CODE_ID ASC
    </select>   


	
	<select id="getSearchCodeList" resultMap="codeVO" parameterType="com.offact.addys.vo.ADCodeManageVO" >
	SELECT A.*
	FROM
	(
	    SELECT
	             @ROWNUM := @ROWNUM + 1 AS ROWNUM,
	           a.code_id,
	           b.code_nm, 
	           a.CODE,
	           a.name,
	           a.description,
	           a.using_yn
	    FROM TB_CODE a INNER JOIN  TB_CODE_GROUP b
               on a.CODE_ID=b.CODE_ID,
               (SELECT @ROWNUM := 0) R  
        WHERE a.code_id LIKE #{con_codeId}  
        <if test="searchcodenm != null and searchcodenm != ''" >
        and a.NAME LIKE #{searchcodenm}     
        </if>
        
	    ORDER BY a.code_id , CODE
	) A
	WHERE  A.ROWNUM BETWEEN (#{curPage}-1) * #{rowCount}+1 AND #{curPage} * #{rowCount}
	
	</select>	



    <select id="getSearchCodeListCnt" resultType="int" parameterType="com.offact.addys.vo.ADCodeManageVO" >
        SELECT count(*) as cnt
        FROM TB_CODE a INNER JOIN  TB_CODE_GROUP b
               on a.CODE_ID=b.CODE_ID,
               (SELECT @ROWNUM := 0) R  
        WHERE a.code_id LIKE #{con_codeId}  
        <if test="searchcodenm != null and searchcodenm != ''" >
        and a.NAME LIKE #{searchcodenm}     
        </if>     
    </select>   




    <select id="checkCode"  resultType="int" parameterType="com.offact.addys.vo.ADCodeManageVO">
        select count(*) from TB_CODE where code_id = #{codeId} and CODE = #{code}
    </select>
    
    
    
  	<insert id="insertCode" parameterType="com.offact.addys.vo.ADCodeManageVO" >
  	INSERT INTO TB_CODE (
  		  CODE_ID
  		, CODE
  		, NAME
  		, DESCRIPTION
  		, USING_YN
  		, FRST_REGR_ID
  		, FRST_REG_TS
  		, LAST_CORT_ID
  		, LAST_MOD_TS
  	)
  	VALUES (
  		  #{codeId}
  		, #{code}
  		, #{name}
  		, #{description}
  		, #{usingYn}
  		, #{frstRegrId}
  		, now()
  		, #{lastCortId}
  		, now()
  	)
  	</insert>  
  	
  	<update id="modifyCode" parameterType="com.offact.addys.vo.ADCodeManageVO" >
    UPDATE TB_CODE
    SET  NAME     = #{name}
         , USING_YN    = #{usingYn}
         , DESCRIPTION = #{description}
         , LAST_MOD_TS    = now()
    WHERE CODE_ID = #{codeId}
    AND CODE = #{code}
  	</update>  	
  	 
	<delete id="deleteCode" parameterType="com.offact.addys.vo.ADCodeManageVO" >
		DELETE FROM SAMPLE_NOTICE
		WHERE NO = #{no}
	</delete>
	
	
	
   <select id="getPopupCodeList" resultMap="codeVO" parameterType="com.offact.addys.vo.ADCodeManageVO" >
    SELECT  TB_CODE.code_id,
            TB_CODE.code,
            TB_CODE.name,
            TB_CODE.description,
            TB_CODE.using_yn
     FROM   TB_CODE
     WHERE  TB_CODE.code_id = #{codeId}
  </select>
	
</mapper>
